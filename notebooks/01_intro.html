<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Survival analysis &mdash; sparsesurv  documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../_static/nbsphinx-code-cells.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../_static/jquery.js?v=5d32c60e"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../_static/documentation_options.js?v=5929fcd5"></script>
        <script src="../_static/doctools.js?v=888ff710"></script>
        <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
        <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Tutorials" href="../tutorials.html" />
    <link rel="prev" title="Overview" href="../overview.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            sparsesurv
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../installation.html">Installation</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../overview.html">Overview</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../overview.html#datasets">Datasets</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../overview.html#methods">Methods</a><ul class="current">
<li class="toctree-l3 current"><a class="current reference internal" href="#">Survival analysis</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Knowledge-distillation">Knowledge distillation</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Minimal-example-of-sparsesurv">Minimal example of <em>sparsesurv</em></a></li>
<li class="toctree-l3"><a class="reference internal" href="#References">References</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../tutorials.html">Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="../sparsesurv_api/sparsesurv.html">API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../references.html">References</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">sparsesurv</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../overview.html">Overview</a></li>
      <li class="breadcrumb-item active">Survival analysis</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/notebooks/01_intro.ipynb.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="Survival-analysis">
<h1>Survival analysis<a class="headerlink" href="#Survival-analysis" title="Link to this heading"></a></h1>
<p>sparsesurv [1] operates on survival analysis data. Below, we quote the notation from the supplementary section of our manuscript to ensure we are on the same page in terms of notation and language.</p>
<blockquote>
<div><p>In particular survival concerns the analysis and modeling of a non-negative random variable <span class="math notranslate nohighlight">\(T &gt; 0\)</span>, that is used to model the time until an event of interest occurs. In observational survival datasets, we let <span class="math notranslate nohighlight">\(T_i\)</span> and <span class="math notranslate nohighlight">\(C_i\)</span> denote the event and right-censoring times of patient <span class="math notranslate nohighlight">\(i\)</span>. In right-censored survival analysis, we observe triplets <span class="math notranslate nohighlight">\((x_i, \delta_i, O_i)\)</span>, where <span class="math notranslate nohighlight">\(O_i = \text{min}(T_i, C_i)\)</span> and <span class="math notranslate nohighlight">\(\delta_i = {1}(T_i \leq C_i)\)</span>. Throughout we
assume conditionally independent censoring and non-informative censoring. That is, <span class="math notranslate nohighlight">\(T \perp\!\!\!\!\perp C \mid X\)</span> and <span class="math notranslate nohighlight">\(C\)</span> may not be a function of any of the parameters of <span class="math notranslate nohighlight">\(T\)</span> <span class="math">\citep{kalbfleisch2011statistical}</span>. Further, let <span class="math notranslate nohighlight">\(\lambda\)</span> denote the hazard function, <span class="math notranslate nohighlight">\(\Lambda\)</span> be the cumulative hazard function, and <span class="math notranslate nohighlight">\(S(t) = 1 - F(t)\)</span> be the survival function, where <span class="math notranslate nohighlight">\(F(t)\)</span> denotes the cumulative distribution function. We let
<span class="math notranslate nohighlight">\(\tilde T\)</span> be the set of unique, ascending-ordered death times. <span class="math notranslate nohighlight">\(R_i\)</span> is the risk set at time <span class="math notranslate nohighlight">\(i\)</span>, that is, <span class="math notranslate nohighlight">\(R(i) = \{j: O_j \geq O_i\}\)</span>. <span class="math notranslate nohighlight">\(D_i\)</span> denotes the death set at time <span class="math notranslate nohighlight">\(i\)</span>, <span class="math notranslate nohighlight">\(D(i) = \{j: O_j = i \land \delta_i = 1\}\)</span>.</p>
</div></blockquote>
<p>For now, <em>sparsesurv</em> operats solely on right censored data, although we may consider an extension to other censoring and truncation schemes, if there is interest. We now briefly show an example right-censored survival dataset available in <em>scikit-survival</em> [4], another Python package for survival analysis.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>from sksurv.datasets import load_flchain
X, y = load_flchain()
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>X
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>age</th>
      <th>chapter</th>
      <th>creatinine</th>
      <th>flc.grp</th>
      <th>kappa</th>
      <th>lambda</th>
      <th>mgus</th>
      <th>sample.yr</th>
      <th>sex</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>97.0</td>
      <td>Circulatory</td>
      <td>1.7</td>
      <td>10</td>
      <td>5.700</td>
      <td>4.860</td>
      <td>no</td>
      <td>1997</td>
      <td>F</td>
    </tr>
    <tr>
      <th>1</th>
      <td>92.0</td>
      <td>Neoplasms</td>
      <td>0.9</td>
      <td>1</td>
      <td>0.870</td>
      <td>0.683</td>
      <td>no</td>
      <td>2000</td>
      <td>F</td>
    </tr>
    <tr>
      <th>2</th>
      <td>94.0</td>
      <td>Circulatory</td>
      <td>1.4</td>
      <td>10</td>
      <td>4.360</td>
      <td>3.850</td>
      <td>no</td>
      <td>1997</td>
      <td>F</td>
    </tr>
    <tr>
      <th>3</th>
      <td>92.0</td>
      <td>Circulatory</td>
      <td>1.0</td>
      <td>9</td>
      <td>2.420</td>
      <td>2.220</td>
      <td>no</td>
      <td>1996</td>
      <td>F</td>
    </tr>
    <tr>
      <th>4</th>
      <td>93.0</td>
      <td>Circulatory</td>
      <td>1.1</td>
      <td>6</td>
      <td>1.320</td>
      <td>1.690</td>
      <td>no</td>
      <td>1996</td>
      <td>F</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>7869</th>
      <td>52.0</td>
      <td>NaN</td>
      <td>1.0</td>
      <td>6</td>
      <td>1.210</td>
      <td>1.610</td>
      <td>no</td>
      <td>1995</td>
      <td>F</td>
    </tr>
    <tr>
      <th>7870</th>
      <td>52.0</td>
      <td>NaN</td>
      <td>0.8</td>
      <td>1</td>
      <td>0.858</td>
      <td>0.581</td>
      <td>no</td>
      <td>1999</td>
      <td>F</td>
    </tr>
    <tr>
      <th>7871</th>
      <td>54.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>8</td>
      <td>1.700</td>
      <td>1.720</td>
      <td>no</td>
      <td>2002</td>
      <td>F</td>
    </tr>
    <tr>
      <th>7872</th>
      <td>53.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>9</td>
      <td>1.710</td>
      <td>2.690</td>
      <td>no</td>
      <td>1995</td>
      <td>F</td>
    </tr>
    <tr>
      <th>7873</th>
      <td>50.0</td>
      <td>NaN</td>
      <td>0.7</td>
      <td>4</td>
      <td>1.190</td>
      <td>1.250</td>
      <td>no</td>
      <td>1998</td>
      <td>F</td>
    </tr>
  </tbody>
</table>
<p>7874 rows × 9 columns</p>
</div></div>
</div>
<p>The design matrix <span class="math notranslate nohighlight">\(X\)</span> looks the same as it would in other modeling settings, such as regression or classification, and thus does not require any special treatment from a modeling point of view.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>y
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
array([( True,   85.), ( True, 1281.), ( True,   69.), ...,
       (False, 2507.), (False, 4982.), (False, 3995.)],
      dtype=[(&#39;death&#39;, &#39;?&#39;), (&#39;futime&#39;, &#39;&lt;f8&#39;)])
</pre></div></div>
</div>
<p>The target <span class="math notranslate nohighlight">\(y\)</span> looks weird upon first glance however, as it contains two elements for each sample. These correspond exactly to <span class="math notranslate nohighlight">\(O_i\)</span> and <span class="math notranslate nohighlight">\(\delta_i\)</span> in our notation section above and respectively represent the censoring indicator and the observed time. Right-censored survival data is generally represented in structured array as is shown here, having one element for the censoring indicator and the observed time:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>y[&quot;death&quot;]
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
array([ True,  True,  True, ..., False, False, False])
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>(y[&quot;death&quot;]).astype(int)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
array([1, 1, 1, ..., 0, 0, 0])
</pre></div></div>
</div>
<p>While the number of covariates relative to the number of is quite good here (only 9 variables for 7,874 samples), a very common setting in (cancer) survival anaylsis is one where the number of available covariates is much larger than the number of available samples (i.e., <span class="math notranslate nohighlight">\(p &gt;&gt; n\)</span>). This is exactly the setting that <em>sparsesurv</em> is designed for. <em>sparsesurv</em> is based on knowledge distillation [5], which is also referred to as preconditioning [2] or reference models in statistics [3]. Thus,
we briefly introduce the idea of knowledge distillation next.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>X.shape
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
(7874, 9)
</pre></div></div>
</div>
</section>
<section id="Knowledge-distillation">
<h1>Knowledge distillation<a class="headerlink" href="#Knowledge-distillation" title="Link to this heading"></a></h1>
<p>The original idea of knowledge distillation was not directly related interpretabiltiy or feature selection. We note however, that the idea of using something akin to knowledge distillation was used and proposed in statistics before knowledge distillation itself, under the name of preconditioning. We will continue to use the name knowledge distillation since it may be more familiar to readers in the machine learning community.</p>
<p>The actual process of knowledge distillation proceeds in two steps:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>1. Fit a teacher model that can approximate the target of interest (very) well

2. Fit a student model on the predictions of the teacher model, hoping that the teacher model acts as a kind of noise filter
</pre></div>
</div>
<p>We illustrate how this process can be adapted to survival analysis. Please note that this running example will continue to use <code class="docutils literal notranslate"><span class="pre">scikit-survival</span></code>, before we move on to high-dimensional data.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>from sksurv.ensemble import RandomSurvivalForest
from sksurv.linear_model import CoxPHSurvivalAnalysis
from sklearn.linear_model import LinearRegression
from sklearn.preprocessing import StandardScaler
from sklearn.pipeline import make_pipeline
from sksurv.metrics import concordance_index_censored

X_train = X.iloc[:5000, [0, 3, 4]]
X_test = X.iloc[5000:, [0, 3, 4]]
y_train = y[:5000]
y_test = y[5000:]

teacher_pipe = make_pipeline(StandardScaler(), RandomSurvivalForest())
student_pipe = make_pipeline(StandardScaler(), LinearRegression())
baseline_pipe = make_pipeline(StandardScaler(), CoxPHSurvivalAnalysis())

teacher_pipe.fit(X_train, y_train)
student_pipe.fit(X_train, teacher_pipe.predict(X_train))
baseline_pipe.fit(X_train, y_train)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<style>#sk-container-id-1 {color: black;background-color: white;}#sk-container-id-1 pre{padding: 0;}#sk-container-id-1 div.sk-toggleable {background-color: white;}#sk-container-id-1 label.sk-toggleable__label {cursor: pointer;display: block;width: 100%;margin-bottom: 0;padding: 0.3em;box-sizing: border-box;text-align: center;}#sk-container-id-1 label.sk-toggleable__label-arrow:before {content: "▸";float: left;margin-right: 0.25em;color: #696969;}#sk-container-id-1 label.sk-toggleable__label-arrow:hover:before {color: black;}#sk-container-id-1 div.sk-estimator:hover label.sk-toggleable__label-arrow:before {color: black;}#sk-container-id-1 div.sk-toggleable__content {max-height: 0;max-width: 0;overflow: hidden;text-align: left;background-color: #f0f8ff;}#sk-container-id-1 div.sk-toggleable__content pre {margin: 0.2em;color: black;border-radius: 0.25em;background-color: #f0f8ff;}#sk-container-id-1 input.sk-toggleable__control:checked~div.sk-toggleable__content {max-height: 200px;max-width: 100%;overflow: auto;}#sk-container-id-1 input.sk-toggleable__control:checked~label.sk-toggleable__label-arrow:before {content: "▾";}#sk-container-id-1 div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-1 div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-1 input.sk-hidden--visually {border: 0;clip: rect(1px 1px 1px 1px);clip: rect(1px, 1px, 1px, 1px);height: 1px;margin: -1px;overflow: hidden;padding: 0;position: absolute;width: 1px;}#sk-container-id-1 div.sk-estimator {font-family: monospace;background-color: #f0f8ff;border: 1px dotted black;border-radius: 0.25em;box-sizing: border-box;margin-bottom: 0.5em;}#sk-container-id-1 div.sk-estimator:hover {background-color: #d4ebff;}#sk-container-id-1 div.sk-parallel-item::after {content: "";width: 100%;border-bottom: 1px solid gray;flex-grow: 1;}#sk-container-id-1 div.sk-label:hover label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-1 div.sk-serial::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 0;bottom: 0;left: 50%;z-index: 0;}#sk-container-id-1 div.sk-serial {display: flex;flex-direction: column;align-items: center;background-color: white;padding-right: 0.2em;padding-left: 0.2em;position: relative;}#sk-container-id-1 div.sk-item {position: relative;z-index: 1;}#sk-container-id-1 div.sk-parallel {display: flex;align-items: stretch;justify-content: center;background-color: white;position: relative;}#sk-container-id-1 div.sk-item::before, #sk-container-id-1 div.sk-parallel-item::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 0;bottom: 0;left: 50%;z-index: -1;}#sk-container-id-1 div.sk-parallel-item {display: flex;flex-direction: column;z-index: 1;position: relative;background-color: white;}#sk-container-id-1 div.sk-parallel-item:first-child::after {align-self: flex-end;width: 50%;}#sk-container-id-1 div.sk-parallel-item:last-child::after {align-self: flex-start;width: 50%;}#sk-container-id-1 div.sk-parallel-item:only-child::after {width: 0;}#sk-container-id-1 div.sk-dashed-wrapped {border: 1px dashed gray;margin: 0 0.4em 0.5em 0.4em;box-sizing: border-box;padding-bottom: 0.4em;background-color: white;}#sk-container-id-1 div.sk-label label {font-family: monospace;font-weight: bold;display: inline-block;line-height: 1.2em;}#sk-container-id-1 div.sk-label-container {text-align: center;}#sk-container-id-1 div.sk-container {/* jupyter's `normalize.less` sets `[hidden] { display: none; }` but bootstrap.min.css set `[hidden] { display: none !important; }` so we also need the `!important` here to be able to override the default hidden behavior on the sphinx rendered scikit-learn.org. See: https://github.com/scikit-learn/scikit-learn/issues/21755 */display: inline-block !important;position: relative;}#sk-container-id-1 div.sk-text-repr-fallback {display: none;}</style><div id="sk-container-id-1" class="sk-top-container"><div class="sk-text-repr-fallback"><pre>Pipeline(steps=[(&#x27;standardscaler&#x27;, StandardScaler()),
                (&#x27;coxphsurvivalanalysis&#x27;, CoxPHSurvivalAnalysis())])</pre><b>In a Jupyter environment, please rerun this cell to show the HTML representation or trust the notebook. <br />On GitHub, the HTML representation is unable to render, please try loading this page with nbviewer.org.</b></div><div class="sk-container" hidden><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-1" type="checkbox" ><label for="sk-estimator-id-1" class="sk-toggleable__label sk-toggleable__label-arrow">Pipeline</label><div class="sk-toggleable__content"><pre>Pipeline(steps=[(&#x27;standardscaler&#x27;, StandardScaler()),
                (&#x27;coxphsurvivalanalysis&#x27;, CoxPHSurvivalAnalysis())])</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-2" type="checkbox" ><label for="sk-estimator-id-2" class="sk-toggleable__label sk-toggleable__label-arrow">StandardScaler</label><div class="sk-toggleable__content"><pre>StandardScaler()</pre></div></div></div><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-3" type="checkbox" ><label for="sk-estimator-id-3" class="sk-toggleable__label sk-toggleable__label-arrow">CoxPHSurvivalAnalysis</label><div class="sk-toggleable__content"><pre>CoxPHSurvivalAnalysis()</pre></div></div></div></div></div></div></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>concordance_index_censored(y_test[&quot;death&quot;], y_test[&quot;futime&quot;], teacher_pipe.predict(X_test))[0]
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
0.5677982023489915
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>concordance_index_censored(y_test[&quot;death&quot;], y_test[&quot;futime&quot;], student_pipe.predict(X_test))[0]
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
0.6479734724443875
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>concordance_index_censored(y_test[&quot;death&quot;], y_test[&quot;futime&quot;], baseline_pipe.predict(X_test))[0]
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
0.6444986225266496
</pre></div></div>
</div>
<p>Interestingly, in this example, the student performance (as measured by Harrell’s concordance) was slightly higher than the baseline, despite the teacher performing quite bad. There is ongoing research in the ML community along these lines. For us, however, all that matters is that knowledge distillation works for survival analysis.</p>
</section>
<section id="Minimal-example-of-sparsesurv">
<h1>Minimal example of <em>sparsesurv</em><a class="headerlink" href="#Minimal-example-of-sparsesurv" title="Link to this heading"></a></h1>
<p>Lastly, we give a brief example of usage of <em>sparsesurv</em>. If you are interested in using <em>sparsesurv</em> on your own data, please consult the documentation or the more specific user guides linked above.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>import pandas as pd
from sparsesurv.utils import transform_survival
df = pd.read_csv(&quot;https://zenodo.org/records/10027434/files/OV_data_preprocessed.csv?download=1&quot;)
<br/></pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>X = df.iloc[:, 3:].to_numpy()
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[15]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>y = transform_survival(time=df.OS_days.values, event=df.OS.values)
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[16]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>X.shape
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[16]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
(302, 19076)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[17]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>y[: 5]
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[17]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
array([( True,  304.), ( True,   24.), (False,  576.), (False, 1207.),
       ( True,  676.)], dtype=[(&#39;event&#39;, &#39;?&#39;), (&#39;time&#39;, &#39;&lt;f8&#39;)])
</pre></div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[18]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>from sklearn.decomposition import PCA
from sparsesurv._base import KDSurv
from sparsesurv.cv import KDPHElasticNetCV
from sparsesurv.utils import transform_survival

pipe = KDSurv(
            teacher=make_pipeline(
                StandardScaler(),
                PCA(n_components=16),
                CoxPHSurvivalAnalysis(ties=&quot;efron&quot;),
            ),
            student=make_pipeline(
                StandardScaler(),
                KDPHElasticNetCV(
                    tie_correction=&quot;efron&quot;,
                    l1_ratio=0.9,
                    eps=0.01,
                    n_alphas=100,
                    cv=5,
                    stratify_cv=True,
                    seed=None,
                    shuffle_cv=False,
                    cv_score_method=&quot;linear_predictor&quot;,
                    n_jobs=1,
                    alpha_type=&quot;min&quot;,
                ),
            ),
        )
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[19]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>pipe.fit(X, y)
</pre></div>
</div>
</div>
<p>Now, we can easily check how many non-zero coefficients the fitted model has, or get predictions on the training set.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[25]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>import numpy as np
np.sum(pipe.student[1].coef_ != 0.0)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[25]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
260
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[26]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>pipe.predict(X)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[26]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
array([ 2.82819899e-01,  4.66079463e-01,  1.15606183e-01,  5.02952325e-01,
        4.17393777e-02, -4.11573164e-01,  7.60555538e-01,  4.34577104e-01,
        1.14479065e-01,  3.75259090e-02, -1.34671115e-02,  1.61175017e-01,
        1.00036148e-01,  2.40373951e-01, -3.25340021e-01, -8.67875954e-01,
        7.96211926e-01, -1.83116380e-01,  1.07281533e-02, -4.77575349e-02,
       -1.43752928e-01,  4.76747822e-01, -1.28454611e-02, -2.77780752e-01,
        1.18303704e-01,  7.13485684e-01, -9.06133817e-02, -2.28805873e-01,
       -1.85240257e-01, -1.88895164e-01,  1.79877864e-02, -4.40709840e-01,
       -3.33191668e-02, -3.47169497e-01, -5.41839603e-02, -7.00115696e-01,
       -4.83739189e-01,  1.49624486e-01,  2.72062364e-01,  7.45285449e-01,
       -7.67869829e-02, -1.82008113e-01, -6.69662687e-02,  8.93221182e-02,
        2.10881649e-01, -5.40481656e-01, -6.76554743e-02,  4.59392323e-02,
       -1.14925641e-01,  1.08297960e-01, -1.48445361e-01,  3.92129238e-01,
        3.46609042e-04,  1.68584073e-01,  1.64706486e-01,  2.00876547e-01,
       -4.59086265e-01, -8.81797220e-02, -3.05503196e-01, -1.06486223e+00,
       -8.44201513e-01,  3.24547683e-01, -1.86346579e-01, -1.51631340e-01,
        1.79803120e-01,  1.06390383e-01, -6.11439908e-01,  6.71797157e-02,
       -6.46251752e-01,  3.26988764e-01,  1.07586534e-01,  3.68125671e-02,
       -3.73012562e-01,  5.57874420e-02,  3.79215839e-01, -2.26237176e-01,
       -1.29248351e-02,  1.22046107e-01,  3.74760349e-01,  5.23166206e-01,
        3.03795116e-01, -7.36812630e-01,  3.94627049e-01,  4.25870853e-02,
        2.98564610e-02,  2.95674650e-01, -2.19203239e-01, -5.11737562e-01,
       -5.24482896e-02, -4.64111839e-03, -3.21799909e-01, -7.14669688e-01,
        5.84417412e-01, -2.90476660e-01,  1.78423635e-01, -2.39300019e-01,
        1.80786722e-01, -3.34470179e-02, -2.56003735e-01, -5.37086393e-02,
       -4.43376994e-01,  3.19931551e-01,  1.97498674e-01, -2.61924192e-02,
        1.33033208e-01, -6.95678071e-02, -7.24221455e-02,  5.40122505e-01,
        2.65075056e-01, -9.89361408e-01,  6.19007678e-02,  2.07408942e-01,
        6.82609874e-02, -6.37693151e-01, -3.20701807e-01, -6.57601954e-01,
        1.24781707e-01,  1.89385766e-01,  2.85797247e-01, -5.92343166e-02,
        3.80218635e-01,  5.44106400e-01,  6.82875840e-01, -3.90579509e-01,
       -8.42389835e-02,  7.58434789e-01, -8.61379695e-02,  7.01730243e-01,
       -1.48692814e-01,  7.07359015e-02, -6.76859547e-02, -4.46045375e-02,
        4.81015185e-01, -1.98355534e-01, -1.59107820e-01, -3.26734493e-01,
        4.56446108e-01, -4.22370601e-01,  8.02473240e-01,  1.50128880e-01,
        6.83395951e-01,  2.06511496e-01,  2.67441747e-01,  8.38858830e-02,
        3.20384092e-01,  6.08116886e-01,  3.70467301e-01, -1.47024656e-02,
        2.73821126e-01, -2.22213948e-01,  3.45943407e-01,  2.92928823e-01,
       -5.43679120e-01,  1.20502523e-01,  5.61094405e-01, -9.07648816e-02,
       -9.08701304e-02,  5.10690412e-01, -1.53761912e-01,  4.23909767e-01,
       -4.37683251e-01,  3.16901267e-01,  3.95289983e-01, -2.98683737e-01,
        2.21080367e-01,  8.72769946e-02,  1.29061883e-01,  1.20706128e-01,
       -1.15802828e-01, -7.05581525e-02, -3.29695109e-01,  2.26276519e-01,
        8.84738248e-01,  1.01021425e-01, -1.40474023e-01, -2.09845104e-01,
       -7.54611778e-02, -5.61162007e-02, -1.97142810e-01,  7.53374053e-02,
        5.01884547e-01, -3.95690048e-01, -1.22748153e-01,  4.00627789e-01,
       -2.17081618e-01, -2.00329194e-01, -1.83593487e-01, -1.00495352e-01,
       -1.27141121e-01,  4.24449987e-02, -9.90337386e-03,  7.94286450e-02,
       -5.22270616e-01,  1.33174475e-01,  9.51870865e-02,  5.27839777e-01,
        5.82771390e-01,  3.33622667e-01, -5.25593641e-01, -4.71537211e-01,
       -4.27592018e-01,  1.73267690e-01,  3.51133339e-01, -1.63715494e-01,
        2.90653134e-01, -2.67936877e-01,  1.74063236e-01,  1.31693212e-01,
        2.69151375e-01, -1.73910919e-01,  3.56312451e-01, -2.95944572e-01,
       -6.76934153e-01,  1.15260613e-01,  7.46456877e-01, -3.96934560e-01,
        6.12222822e-01, -2.83372799e-02, -3.51497255e-01,  6.33327038e-01,
        2.71835304e-01,  2.94155228e-01,  5.16169771e-02,  1.08403732e-02,
        6.67114061e-01, -1.82332792e-01, -1.21011324e-01, -4.54893674e-01,
       -7.96243813e-01,  3.81974552e-01, -1.07648224e-01, -1.71062783e-02,
        2.23721369e-01,  1.36297632e-01,  3.11243091e-01, -7.24278109e-03,
        6.13225615e-02, -3.55728676e-01,  1.71853952e-01,  8.08492454e-01,
        1.08213626e-01,  5.32913239e-02, -9.11289836e-02, -7.65856673e-02,
        1.58455383e-01, -5.23370219e-01, -3.94924071e-01, -1.09364829e-01,
       -3.78914862e-01, -1.89939895e-01, -1.36739936e-01, -2.63573754e-01,
        1.01121780e-01,  7.21476287e-02, -9.03630706e-02,  3.04653321e-01,
        1.10769228e-01, -6.11767145e-01,  2.23789775e-01,  1.68579657e-01,
        5.42411777e-01,  4.75852309e-01,  5.58213127e-01, -4.18131792e-02,
       -4.55969471e-01, -5.50211628e-01, -6.02525807e-01, -1.94368141e-01,
       -3.66442961e-01, -1.26307742e-01,  1.02601869e-01, -5.58109635e-01,
       -2.63724315e-01, -4.75675963e-01,  2.74982443e-01, -4.08772709e-01,
       -7.00331777e-02, -4.36649556e-01, -6.36961440e-02, -3.30293833e-01,
       -2.75192094e-01, -3.93795722e-01, -3.22032629e-01,  4.70539660e-01,
        2.46172417e-01, -1.01038986e-01, -3.22538044e-01, -4.07975457e-01,
        7.72229576e-02, -2.91750927e-01, -2.78907089e-01, -7.91286409e-02,
       -1.04626150e-01,  3.41475254e-01, -1.85888436e-01, -2.36925667e-01,
       -1.33571157e-01, -1.26144809e-01, -4.56658067e-01,  4.44035026e-01,
        1.60457468e-02, -2.75158258e-01])
</pre></div></div>
</div>
</section>
<section id="References">
<h1>References<a class="headerlink" href="#References" title="Link to this heading"></a></h1>
<p>[1] David Wissel, Nikita Janakarajan, Daniel Rowson, Julius Schulte, Xintian Yuan, Valentina Boeva. “sparsesurv: Sparse survival models via knowledge distillation.” (2023, under review).</p>
<p>[2] Paul, Debashis, et al. ““Preconditioning” for feature selection and regression in high-dimensional problems.” (2008): 1595-1618.</p>
<p>[3] Pavone, Federico, et al. “Using reference models in variable selection.” Computational Statistics 38.1 (2023): 349-371.</p>
<p>[4] Pölsterl, Sebastian. “scikit-survival: A Library for Time-to-Event Analysis Built on Top of scikit-learn.” The Journal of Machine Learning Research 21.1 (2020): 8747-8752.</p>
<p>[5] Hinton, Geoffrey, Oriol Vinyals, and Jeff Dean. “Distilling the knowledge in a neural network.” arXiv preprint arXiv:1503.02531 (2015).</p>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="../overview.html" class="btn btn-neutral float-left" title="Overview" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="../tutorials.html" class="btn btn-neutral float-right" title="Tutorials" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright BoevaLab 2023.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>